# 2.ä½¿ç”¨ ARIMAã€è¨é‡Œç›å’ŒåŠ æ³•æ¨¡å‹è¿›è¡Œé¢„æµ‹

æ—¶é—´åºåˆ—åˆ†ææ˜¯ä¸€ç§è§£é‡Šåºåˆ—é—®é¢˜çš„æ–¹æ³•ã€‚å½“è¿ç»­å˜é‡ä¾èµ–äºæ—¶é—´æ—¶ï¼Œè¿™æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚åœ¨é‡‘èé¢†åŸŸï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨å®ƒæ¥å‘ç°å¸‚åœºæ•°æ®ä¸­çš„ä¸€è‡´æ¨¡å¼ï¼Œå¹¶é¢„æµ‹æœªæ¥ä»·æ ¼ã€‚æœ¬ç« å…¨é¢ä»‹ç»äº†æ—¶é—´åºåˆ—åˆ†æã€‚å®ƒé¦–å…ˆåŒ…æ‹¬ä½¿ç”¨å¢å¼ºçš„ Dickey-Fuller (ADF)æµ‹è¯•å’Œç™½å™ªå£°å’Œè‡ªç›¸å…³æµ‹è¯•æ¥å¯»æ‰¾å¹³ç¨³åºåˆ—æ•°æ®çš„æ–¹æ³•ã€‚ç¬¬äºŒï¼Œå®ƒæ­ç¤ºäº†ä½¿ç”¨å¹³æ»‘ç®€æ´åœ°æ€»ç»“æ—¶é—´åºåˆ—æ•°æ®ä¸­çš„æ¨¡å¼çš„æŠ€æœ¯ï¼Œå¦‚ç§»åŠ¨å¹³å‡æŠ€æœ¯å’ŒæŒ‡æ•°æŠ€æœ¯ã€‚ç¬¬ä¸‰ï¼Œå®ƒæ°å½“åœ°æ¶µç›–äº†æŠ•èµ„å›æŠ¥ç‡çš„ä¼°ç®—ã€‚æœ€åï¼Œå®ƒæ¶µç›–è¶…å‚æ•°ä¼˜åŒ–å’Œæ¨¡å‹å¼€å‘å’Œè¯„ä¼°ã€‚æœ¬ç« ä½¿æ‚¨èƒ½å¤Ÿè®¾è®¡ã€å¼€å‘å’Œæµ‹è¯•æ—¶é—´åºåˆ—åˆ†ææ¨¡å‹ï¼Œå¦‚è‡ªå›å½’ç»¼åˆç§»åŠ¨å¹³å‡(ARIMA)æ¨¡å‹ã€å­£èŠ‚æ€§ ARIMA(è¨é‡Œç›)æ¨¡å‹å’ŒåŠ æ³•æ¨¡å‹ï¼Œä»¥è¯†åˆ«è´§å¸å¯¹çš„æ¨¡å¼å¹¶é¢„æµ‹æœªæ¥ä»·æ ¼ã€‚åœ¨è¿™ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`pandas_datareader`ä»é›…è™è´¢ç»æœé›†è´¢åŠ¡æ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨`conda install -c anaconda pandas-datareader`ã€‚å¯¹äºæ—¶é—´åºåˆ—å»ºæ¨¡ï¼Œæˆ‘ä»¬ä½¿ç”¨é¢„è£…åœ¨ Python ç¯å¢ƒä¸­çš„`statsmodels`åº“ã€‚æˆ‘ä»¬ä¹Ÿç”¨`pmdarima`ï¼Œå®ƒæ˜¯`statsmodels`çš„å»¶ä¼¸ã€‚è¦åœ¨ Python ç¯å¢ƒä¸­å®‰è£…å®ƒï¼Œæˆ‘ä»¬ä½¿ç”¨`pip install pmdarima`ï¼›åœ¨ conda ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`conda install -c saravji pmdarima`ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ FB Prophet è¿›è¡Œé«˜è´¨é‡çš„æ—¶é—´åºåˆ—åˆ†æã€‚è¦åœ¨ Python ç¯å¢ƒä¸­å®‰è£…å®ƒï¼Œæˆ‘ä»¬ä½¿ç”¨`pip install fbprophet`ï¼›åœ¨ conda ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`conda install -c conda-forge fbprophet`ã€‚åœ¨å®‰è£…`fbprophet`ä¹‹å‰ï¼Œç¡®ä¿é¦–å…ˆå®‰è£…`pystan`ã€‚ä¸ºäº†å®‰è£…`pystan`ï¼Œæˆ‘ä»¬ä½¿ç”¨`conda install -c conda-forge pystan`ã€‚

Anaconda æ˜¯æœ€å—æ¬¢è¿çš„å¼€æº Python å‘è¡Œç‰ˆï¼Œå®ƒä½¿ç”¨æˆ·èƒ½å¤Ÿç®¡ç†ã€å®‰è£…ã€æ›´æ–°å’Œç®¡ç†è½¯ä»¶åŒ…(ä» [`https://www.anaconda.com/products/individual`](https://www.anaconda.com/products/individual) ä¸‹è½½å¹³å°)ã€‚æ‚¨å¯ä»¥åœ¨ Windowsã€macOS å’Œ Linux æ“ä½œç³»ç»Ÿä¸Šå®‰è£…è¯¥å¹³å°ã€‚åœ¨ [`https://docs.anaconda.com/anaconda-enterprise/system-requirements/`](https://docs.anaconda.com/anaconda-enterprise/system-requirements/) äº†è§£æ›´å¤šå…³äºç³»ç»Ÿè¦æ±‚å’Œç¡¬ä»¶è¦æ±‚ã€‚

## è¡ŒåŠ¨ä¸­çš„æ—¶é—´åºåˆ—

æ—¶é—´åºåˆ—åˆ†æé€‚åˆäºä¼°è®¡ä¸æ—¶é—´ç›¸å…³çš„è¿ç»­å˜é‡ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥è¯†åˆ«é¡ºåºæ•°æ®çš„ç»“æ„ã€‚è¿™æ˜¯ä¸€ä¸ªæ— ç¼çš„æ–¹æ³•æ¥è¯†åˆ«æ¨¡å¼å’Œé¢„æµ‹è´§å¸å¯¹çš„æœªæ¥ä»·æ ¼ã€‚å¸‚åœºæ•°æ®é€šå¸¸æ˜¯è¿ç»­çš„ï¼Œæœ‰ä¸€äº›éšæœºå› ç´ ï¼Œè¿™æ„å‘³ç€æœ‰ä¸€ä¸ªæ½œåœ¨çš„éšæœºè¿‡ç¨‹ã€‚æˆ‘ä»¬åˆ†æäº†ä¸–ç•Œä¸Šäº¤æ˜“æœ€é¢‘ç¹çš„è´§å¸å¯¹ä¹‹ä¸€ï¼Œç¾å…ƒ($)å’Œæ—¥å…ƒ( )ï¼Œæˆ–(ç¾å…ƒ/æ—¥å…ƒ)å¯¹çš„å†å²æ•°æ®ã€‚æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯å‘ç°è´§å¸å¯¹è°ƒæ•´åçš„æ”¶ç›˜ä»·éšæ—¶é—´å˜åŒ–çš„æ¨¡å¼ï¼Œç„¶åå¯¹ä»·æ ¼å˜åŠ¨åšå‡ºå¯é çš„é¢„æµ‹ã€‚è¦åˆ›å»ºæ—¶é—´åºåˆ—æ¨¡å‹ï¼Œé¦–å…ˆå¯åŠ¨ Jupyter Notebook å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç¬”è®°æœ¬ã€‚

æ¸…å• [2-1](#PC1) æ”¶é›† 2010 å¹´ 11 æœˆ 1 æ—¥è‡³ 2020 å¹´ 11 æœˆ 2 æ—¥ç¾å…ƒ/æ—¥å…ƒå¯¹çš„ä»·æ ¼æ•°æ®(è§è¡¨ [2-1](#Tab1) )ã€‚

è¡¨ 2-1

èµ„æ–™ç»„

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"> <col class="tcol4 align-left"> <col class="tcol5 align-left"> <col class="tcol6 align-left"> <col class="tcol7 align-left"></colgroup> 
| 

**æ—¥æœŸ**

 | 

é«˜çš„

 | 

ä½çš„

 | 

æ‰“å¼€

 | 

å…³é—­

 | 

å·

 | 

æ¥è¿‘çš„

 |
| --- | --- | --- | --- | --- | --- | --- |
| **2010-11-01** | 81.111000 | 80.320000 | 80.572998 | 80.405998 | Zero | 80.405998 |
| **2010-11-02** | 80.936996 | 80.480003 | 80.510002 | 80.558998 | Zero | 80.558998 |
| **2010-11-03** | 81.467003 | 80.589996 | 80.655998 | 80.667999 | Zero | 80.667999 |
| **2010-11-04** | 81.199997 | 80.587997 | 81.057999 | 81.050003 | Zero | 81.050003 |
| **2010-11-05** | 81.430000 | 80.619003 | 80.769997 | 80.776001 | Zero | 80.776001 |

```py
import pandas as pd
from pandas_datareader import data
start_date = '2010-11-01'
end_date = '2020-11-01'
ticker = 'usdjpy=x'
df = data.get_data_yahoo(ticker, start_date, end_date)
df.head()

Listing 2-1Scrap Data

```

å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯¹è°ƒæ•´åçš„æ”¶ç›˜ä»·æ„Ÿå…´è¶£ã€‚æ¸…å• [2-2](#PC2) åˆ é™¤äº†æˆ‘ä»¬ä¸ä¼šç”¨åˆ°çš„åˆ—ã€‚

```py
del df["Open"]
del df["High"]
del df["Low"]
del df["Close"]
del df["Volume"]
df = df.dropna()
df.info()
<class 'pandas.core.frame.DataFrame'>

DatetimeIndex: 2606 entries, 2010-11-01 to 2020-11-02
Data columns (total 1 columns):
 #   Column     Non-Null Count  Dtype
---  ------     --------------  -----
 0   Adj Close  2606 non-null   float64
dtypes: float64(1)
memory usage: 40.7 KB

Listing 2-2Delete Columns and Drop Missing Values

```

åœ¨è¿™ä¸ªæ¸…å•ä¸­ï¼Œæˆ‘ä»¬åˆ é™¤äº†å¤§éƒ¨åˆ†åˆ—å¹¶ä¸¢å¼ƒäº†ä¸¢å¤±çš„å€¼ã€‚å‰©ä¸‹ä¸€æ æ˜¯è°ƒæ•´åæ”¶ç›˜ä»·æ ï¼›æ ¼å¼æ˜¯ Adj Closeã€‚

## å°†æ•°æ®åˆ†ä¸ºè®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®

æ—¶åºæ•°æ®ä¸­æœ‰ 2ï¼Œ606 ä¸ªæ•°æ®ç‚¹ã€‚æ¸…å• [2-3](#PC3) ä½¿ç”¨ 80/20 åˆ†å‰²è§„åˆ™åˆ†å‰²æ•°æ®(å‰ 2085 ä¸ªæ•°æ®ç‚¹ç”¨äºè®­ç»ƒæ¨¡å‹ï¼Œå…¶ä½™çš„ç”¨äºæµ‹è¯•æ¨¡å‹)ã€‚

```py
train = df[:2085]
test = df[2085:]

Listing 2-3Split Data into Training and Test Data

```

## ç™½å™ªå£°æµ‹è¯•

å¦‚æœæ—¶é—´åºåˆ—æ•°æ®æ˜¯å¹³ç¨³çš„ï¼Œé‚£ä¹ˆå®ƒåŒ…å«ç™½å™ªå£°ã€‚ç ”ç©¶ç™½å™ªå£°æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ç”Ÿæˆéšæœºæ•°æ®ï¼Œå¹¶æ‰¾å‡ºä»»æ„æ•°æ®ä¸­æ˜¯å¦å­˜åœ¨ç™½å™ªå£°ã€‚æ¸…å• [2-4](#PC4) è¿”å›éšæœºæ•°å¹¶ç»˜åˆ¶ä¸åŒæ»åçš„è‡ªç›¸å…³å›¾(è§å›¾ [2-1](#Fig1) )ã€‚

![img/509469_1_En_2_Fig1_HTML.jpg](img/509469_1_En_2_Fig1_HTML.jpg)

å›¾ 2-1

éšæœºç™½å™ªå£°æµ‹è¯•

```py
from pandas.plotting import autocorrelation_plot
import matplotlib.pyplot as plt
import numpy as np
randval = np.random.randn(1000)
autocorrelation_plot(randval)
plt.show()

Listing 2-4White Noise Test

```

å›¾ [2-1](#Fig1) æ˜¾ç¤ºç³»åˆ—ä¸­æ²¡æœ‰ç™½å™ªå£°ï¼Œå› ä¸ºåœ¨ 95%å’Œ 99%çš„ç½®ä¿¡åŒºé—´ä¸Šæœ‰æ˜æ˜¾çš„å°–å³°ã€‚åˆ—è¡¨ [2-5](#PC5) ç»˜åˆ¶è®­ç»ƒæ•°æ®è‡ªç›¸å…³ä»¥æ˜¾ç¤ºç™½å™ªå£°(è§å›¾ [2-2](#Fig2) )ã€‚

![img/509469_1_En_2_Fig2_HTML.jpg](img/509469_1_En_2_Fig2_HTML.jpg)

å›¾ 2-2

è®­ç»ƒæ•°æ®ç™½å™ªå£°æµ‹è¯•

```py
autocorrelation_plot(train["Adj Close"])
plt.show()

Listing 2-5Training Data White Noise Test

```

å›¾ [2-2](#Fig2) æ˜¾ç¤ºæ»å 1 å‡ºç°æ€¥å‰§ä¸‹é™ï¼Œåœ¨ç¬¬ 500 ä¸ªæ»åä¹‹åï¼Œè¯¥çº¿ä¸‹é™å¹¶æ¥è¿‘é›¶ã€‚ç”±äºæ‰€æœ‰è‡ªç›¸å…³ä¸ç­‰äºé›¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤æ²¡æœ‰ç™½å™ªå£°ã€‚

## æ–‡å…·æµ‹è¯•

æœ‰åºæ•°æ®ä¸­éšæœºè¿‡ç¨‹çš„å­˜åœ¨å¯èƒ½ä¼šå½±å“ç»“è®ºã€‚æ¸…å• [2-6](#PC6) ä½¿ç”¨ä¸€ä¸ªè¢«ç§°ä¸ºå¢å¹¿çš„ Dickey-Fuller æ£€éªŒçš„å•ä½æ ¹æ£€éªŒæ¥æ£€æŸ¥åºåˆ—æ˜¯å¦å¹³ç¨³(è§è¡¨ [2-2](#Tab2) )ã€‚å½“ç³»åˆ—æ•°æ®çš„å¹³å‡å€¼ä¸ºé›¶æ—¶ï¼Œç³»åˆ—æ˜¯ç¨³å®šçš„ï¼Œè¿™æ„å‘³ç€è§‚å¯Ÿå€¼ä¸ä¼šéšæ—¶é—´è€Œå˜åŒ–ã€‚å½“ p å€¼å¤§äº 0.05 æ—¶ï¼Œä½¿ç”¨å¢å¼ºçš„ Dickey-Fuller (ADF)æ£€éªŒï¼Œæˆ‘ä»¬ä¸ä¼šæ‹’ç»å‡è®¾ã€‚

ADF æ£€éªŒçš„å‡è®¾å¦‚ä¸‹:

*   *é›¶å‡è®¾:*æ²¡æœ‰å•ä½æ ¹ã€‚

*   *æ›¿ä»£å‡è®¾:*æœ‰å•ä½æ ¹ã€‚

å½“ ADF F%ç»Ÿè®¡å€¼å°äºé›¶ä¸” p å€¼å°äº 0.05 æ—¶ï¼Œåºåˆ—æ˜¯éå¹³ç¨³çš„ã€‚

```py
from statsmodels.tsa.stattools import adfuller
adfullerreport = adfuller(train["Adj Close"])
adfullerreportdata = pd.DataFrame(adfullerreport[0:4],
                                  columns = ["Values"],
                                  index=["ADF F% statistics",
                                         "P-value",
                                         "No. of lags used",
                                         "No. of observations"])
adfullerreportdata

Listing 2-6Augmented Dickey-Fuller Test

```

è¡¨ 2-2

f ç»Ÿè®¡

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"></colgroup> 
| Â  | 

ä»·å€¼è§‚å¿µ

 |
| --- | --- |
| **ADF F%ç»Ÿè®¡æ•°æ®** | -1.267857 |
| **P å€¼** | 0.643747 |
| **ä½¿ç”¨çš„æ»åæ•°é‡** | 6.000000 |
| **è§‚å¯Ÿæ•°é‡** | 2078.000000 |

è¡¨ [2-2](#Tab2) çªå‡ºæ˜¾ç¤º F ç»Ÿè®¡ç»“æœä¸ºè´Ÿï¼Œp å€¼å¤§äº 0.05ã€‚æˆ‘ä»¬ä¸æ‹’ç»é›¶å‡è®¾ï¼›è¯¥åºåˆ—æ˜¯éå¹³ç¨³çš„ã€‚è¿™å°±è¦æ±‚åºåˆ—éœ€è¦å·®åˆ†ã€‚

### è‡ªç›¸å…³å‡½æ•°

åˆ—è¡¨ [2-7](#PC7) ç¡®å®š y å’Œ y <sub>t</sub> ä¹‹é—´çš„åºåˆ—ç›¸å…³æ€§(y <sub>t</sub> éœ€è¦åœ¨æ—¶é—´æ®µ <sub>t</sub> å†…æµ‹é‡è§‚å¯Ÿå€¼ *y* )ã€‚å½“æˆ‘ä»¬è€ƒè™‘è¶‹åŠ¿ã€å­£èŠ‚æ€§ã€å‘¨æœŸæ€§å’Œæ®‹å·®æˆåˆ†æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨è‡ªç›¸å…³å‡½æ•°æ¥è¡¡é‡ä¸€ä¸ªåºåˆ—çš„ç°å€¼ä¸å…ˆå‰å€¼çš„ç›¸å…³ç¨‹åº¦ã€‚

å›¾ [2-3](#Fig3) æ˜¾ç¤ºå¤§å¤šæ•°å³°å€¼åœ¨ç»Ÿè®¡ä¸Šå¹¶ä¸æ˜¾è‘—ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨åè‡ªç›¸å…³å‡½æ•°(PACF)æ¥è¿›ä¸€æ­¥æ£€æŸ¥æ»åä¹‹é—´çš„éƒ¨åˆ†åºåˆ—ç›¸å…³æ€§ã€‚

![img/509469_1_En_2_Fig3_HTML.jpg](img/509469_1_En_2_Fig3_HTML.jpg)

å›¾ 2-3

è‡ªç›¸å…³

```py
from statsmodels.graphics.tsaplots import plot_acf
plot_acf(train["Adj Close"])
plt.xlabel("Lag")
plt.ylabel("ACF")
plt.show()

Listing 2-7Autocorrelation

```

### éƒ¨åˆ†è‡ªç›¸å…³å‡½æ•°

PACF å›¾è¡¨è¾¾äº†åœ¨ä½æ°´å¹³æ»åæ—¶æ²¡æœ‰æè¿°çš„éƒ¨åˆ†ç›¸å…³ç³»æ•°ã€‚æ¸…å• [2-8](#PC8) æ„å»ºäº† PACF å›¾(è§å›¾ [2-4](#Fig4) )ã€‚

![img/509469_1_En_2_Fig4_HTML.jpg](img/509469_1_En_2_Fig4_HTML.jpg)

å›¾ 2-4

åè‡ªç›¸å…³

```py
from statsmodels.graphics.tsaplots import plot_pacf
plot_pacf(train["Adj Close"])
plt.xlabel("Lag")
plt.ylabel("ACF")
plt.show()

Listing 2-8Partial Autocorrelation

```

æˆ‘ä»¬ä½¿ç”¨ç›¸å…³å›¾æ¥å‘ç°è§£é‡Š 95%ç½®ä¿¡ç•Œé™ä¹‹å¤–çš„å½±å“çš„æ»åã€‚ä¾‹å¦‚ï¼Œå›¾ [2-3](#Fig3) æ˜¾ç¤ºæ»å 1 å’Œæ»å 2 ä¸­æœ‰ä¸€ä¸ªæ˜¾è‘—çš„å°–å³°ã€‚è¿™æ„å‘³ç€æ»åå¯ä»¥è§£é‡Šæ‰€æœ‰é«˜é˜¶è‡ªç›¸å…³(æœ€å¤šç¬¬äºŒä¸ªæ»åæ˜¯æœ€é«˜é˜¶æ»å)ã€‚å®ƒæ˜¾ç¤ºäº†ä¸å…·æœ‰ç»Ÿè®¡æ„ä¹‰çš„å³°å€¼ã€‚(ä¸€ç›´åˆ°æ»å 2 éƒ½æœ‰å¾ˆå¼ºçš„æ­£ç›¸å…³ï¼›æ»å 2 ä¹‹åï¼Œp å€¼å°äº 0.05ã€‚)è‡ªç›¸å…³æ¥è¿‘äºé›¶ï¼Œåœ¨ç»Ÿè®¡æ§åˆ¶é™„è¿‘(è§å›¾ [2-3](#Fig3) ä¸­è“è‰²è¾¹ç•Œ)ã€‚å¯¹æ—¶é—´åºåˆ—æ•°æ®æœ‰å¾ˆå¼ºçš„ä¾èµ–æ€§ã€‚

## ç§»åŠ¨å¹³å‡å¹³æ»‘æŠ€æœ¯

æœ€å¸¸è§çš„å¹³æ»‘æŠ€æœ¯æ˜¯ç§»åŠ¨å¹³å‡(MA)æŠ€æœ¯ï¼›å®ƒè¿”å›å…ˆå‰æ•°æ®ç‚¹å’Œæ–°æ•°æ®ç‚¹çš„åŠ æƒå¹³å‡å€¼ï¼Œå…¶ä¸­æƒé‡å–å†³äºæ—¶åºæ•°æ®çš„å†…èšåŠ›ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Pandas æ¥æ‰§è¡Œæ»šåŠ¨çª—å£è®¡ç®—ã€‚ä¹‹åï¼Œæˆ‘ä»¬å‘ç°äº†ä¸¤ä¸ªå›ºå®šå¤§å°çš„ç§»åŠ¨çª—å£çš„æ»šåŠ¨å¹³å‡ã€‚ç§»åŠ¨çª—å£è¡¨ç¤ºç”¨äºè®¡ç®—ç»Ÿè®¡æ•°æ®çš„æ•°æ®ç‚¹çš„æ•°é‡ã€‚æ¸…å• [2-9](#PC9) ä½¿ç”¨ 10 å¤©æ»šåŠ¨çª—å£å’Œ 50 å¤©æ»šåŠ¨çª—å£å¹³æ»‘æ—¶é—´åºåˆ—æ•°æ®(è§å›¾ [2-5](#Fig5) )ã€‚

![img/509469_1_En_2_Fig5_HTML.jpg](img/509469_1_En_2_Fig5_HTML.jpg)

å›¾ 2-5

æ—¶é—´åºåˆ—(10 å¤©å’Œ 50 å¤©ç§»åŠ¨å¹³å‡çº¿)

```py
MA10 = train["Adj Close"].rolling(window=10).mean()
MA50 = train["Adj Close"].rolling(window=50).mean()
df.plot(kind="line",color="navy")
MA10.plot(kind="line",color="green",label="10D MA")
MA50.plot(kind="line",color="orange",label="50D MA")
plt.xlabel("Date")
plt.xticks(rotation=45)
plt.ylabel("Adj Close")
plt.legend()
plt.show()

Listing 2-9Time Series (10-Day and 50-Day Moving Average)

```

## æŒ‡æ•°å¹³æ»‘æŠ€æœ¯

æŒ‡æ•°å¹³æ»‘æ³•å°†çª—å£å¤–çš„å€¼åŠ æƒä¸ºé›¶ï¼Œå…¶ä¸­å·¨å¤§çš„åŠ æƒå€¼è¿…é€Ÿæ¶ˆå¤±ï¼Œè¾ƒå°çš„åŠ æƒå€¼é€æ¸æ¶ˆå¤±ã€‚æ¸…å• [2-10](#PC10) ä½¿ç”¨æŒ‡æ•°å¹³æ»‘æŠ€æœ¯å¹³æ»‘æ—¶é—´åºåˆ—æ•°æ®ï¼Œå¹¶å°†åŠè¡°æœŸè®¾ç½®ä¸º 3ã€‚åŠè¡°æœŸæ˜¯ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šæŒ‡æ•°æƒé‡å‡åŠçš„æ»åæ—¶é—´ã€‚åœ¨æ¸…å• [2-10](#PC10) ä¸­ï¼Œæˆ‘ä»¬å°†å‚æ•°æŒ‡å®šä¸º 3ï¼Œå› ä¸ºåœ¨æ»å 2 ä¹‹å‰æœ‰å¾ˆå¼ºçš„æ­£ç›¸å…³æ€§ï¼›æ»å 2 ä¹‹åï¼Œp å€¼å°äº 0.05(å‚è§å›¾ [2-3](#Fig3) )ã€‚

```py
Exp = train["Adj Close"].ewm(halflife=30).mean()
df.plot(kind="line", color="navy")
Exp.plot(kind="line", color="red", label="Half Life")
plt.xlabel("Time")
plt.ylabel("Adj Close")
plt.xticks(rotation=45)
plt.legend()

plt.show()

Listing 2-10Develop Smooth Series (Exponential)

```

å›¾ [2-6](#Fig6) æ˜¾ç¤ºäº†ä½¿ç”¨ç§»åŠ¨å¹³å‡æŠ€æœ¯å’ŒæŒ‡æ•°æŠ€æœ¯çš„æ—¶é—´åºåˆ—æ•°æ®çš„æ ¸å¿ƒç»“æ„ã€‚

![img/509469_1_En_2_Fig6_HTML.jpg](img/509469_1_En_2_Fig6_HTML.jpg)

å›¾ 2-6

æ—¶é—´åºåˆ—(æŒ‡æ•°)

## æ”¶ç›Šç‡

åˆ—è¡¨ [2-11](#PC11) ä¼°è®¡å¹¶ç»˜åˆ¶äº†èµ„äº§æ”¶ç›Šç‡çš„å¹´å›æŠ¥ç‡(è§å›¾ [2-7](#Fig7) )ã€‚

![img/509469_1_En_2_Fig7_HTML.jpg](img/509469_1_En_2_Fig7_HTML.jpg)

å›¾ 2-7

æ”¶ç›Šç‡

```py
pr = df.pct_change()
pr_plus_one = pr.add(1)
cumulative_return = pr_plus_one.cumprod().sub(1)
fig, ax = plt.subplots()
cummulative_return = cumulative_return.mul(100)
cummulative_return_max = cummulative_return.max()
cummulative_return_min = cummulative_return.min()
cummulative_return.plot(ax=ax, color="purple")
plt.axhline(y=cummulative_return_max.item(), color="green",
            label="Max returns: " + str(round(cummulative_return_max.item(),2)) + " %")
plt.axhline(y=cummulative_return_min.item(), color="red",
            label="Min returns: " + str(round(cummulative_return_min.item(),2)) + " %")

plt.xlabel("Date")
plt.ylabel("Return (%)")
plt.legend(loc="best")
plt.xticks(rotation=45)
plt.show()

Listing 2-11Rate of Return

```

å›¾ [2-7](#Fig7) æ˜¾ç¤ºäº†åå¹´æœŸé—´(ä» 2010 å¹´åˆ° 2020 å¹´)çš„åˆç†å›æŠ¥ç‡ã€‚æœ€ä½åˆ©ç‡ä¸º-5.8%ï¼Œæœ€é«˜åˆ©ç‡ä¸º 56.24%ã€‚

## ARIMA æ¨¡å¼

åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ ARIMA å¯¹è¯¥ç³»åˆ—è¿›è¡Œå»ºæ¨¡ï¼Œå¹¶é¢„æµ‹å…¶æœªæ¥å®ä¾‹ã€‚ARIMA æ˜¯è¿„ä»Šä¸ºæ­¢æœ€å¹¿æ³›çš„å•å˜é‡æ—¶é—´åºåˆ—åˆ†ææ¨¡å‹ã€‚è®©æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹:

*   *è‡ªå›å½’(AR)* :ä¹‹å‰è¯¯å·®çš„çº¿æ€§ç»„åˆã€‚AR è€ƒè™‘å…ˆå‰è§‚æµ‹çš„è§‚æµ‹é¡¹ï¼ŒåŒ…æ‹¬éšæœºç™½å™ªå£°å’Œå…ˆå‰çš„éšæœºç™½å™ªå£°ã€‚

*   *Integrated (I)* :é€šè¿‡å·®åˆ†ä½¿åºåˆ—å¹³ç¨³çš„å˜æ¢(ä¼°è®¡ä¸€å®šæ—¶æœŸå†…è¡Œçš„å˜åŒ–)ã€‚

*   *ç§»åŠ¨å¹³å‡(MA)* :ä¹‹å‰åŠ æƒå¹³å‡å€¼çš„çº¿æ€§ç»„åˆ(å‚è€ƒä¹‹å‰ä»‹ç»çš„ç§»åŠ¨å¹³å‡å¹³æ»‘æŠ€æœ¯)ã€‚

ä¸æœ€å°äºŒä¹˜æ¨¡å‹ç›¸ä¼¼ï¼ŒARIMA å¯¹æ•°æ®ç»“æ„åšå‡ºäº†å¼ºæœ‰åŠ›çš„å‡è®¾ã€‚è¯¥æ¨¡å‹å‡è®¾ç³»åˆ—æ•°æ®çš„ç»“æ„æ˜¯çº¿æ€§çš„å’Œæ­£æ€çš„ã€‚æˆ‘ä»¬å¯ä»¥å°† ARIMA æ¨¡å‹è§†ä¸ºä¸€ç§å¤æ‚çš„å›å½’æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä»¬å°†å›å½’å›å½’ lag1ï¼Œlag2 åº”ç”¨äº lag = *k* ã€‚è¯¥æ¨¡å‹å‡è®¾è¯¥åºåˆ—æ˜¯å¹³ç¨³çš„ã€‚åœ¨åºåˆ—ä¸æ˜¯ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œåºåˆ—å¿…é¡»æ˜¾ç¤ºä¸€æ®µæ—¶é—´å†…çš„è¶‹åŠ¿ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥æ‰§è¡Œæ•°æ®è½¬æ¢æ¥æé«˜æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›ã€‚

### ARIMA è¶…å‚æ•°ä¼˜åŒ–

æ¸…å• [2-11](#PC11) æ‰¾åˆ°æœ€ä½³è¶…å‚æ•°(å…¶é…ç½®æ”¹å˜æ¨¡å‹è¡Œä¸ºçš„å€¼)ã€‚ä¼ ç»Ÿä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨è‡ªç›¸å…³å‡½æ•°(ACF)å’Œ PACF æ¥å¯»æ‰¾æœ€ä¼˜è¶…å‚æ•°ï¼Œè¿™æ˜¯ä¸»è§‚çš„ã€‚æ¸…å• [2-12](#PC12) ä½¿ç”¨`itertools`åŒ…æ¥å¯»æ‰¾ä½¿ç”¨ Akaike ä¿¡æ¯æ ‡å‡†çš„æœ€ä½³è¶…å‚æ•°ï¼Œè¯¥æ ‡å‡†æµ‹é‡æ ·æœ¬å¤–é¢„æµ‹è¯¯å·®ã€‚`itertools`é¢„è£…åœ¨ Python ç¯å¢ƒä¸­ã€‚

```py
from statsmodels.tsa.arima_model import ARIMA
import itertools
p = d = q = range(0, 2)
pdq = list(itertools.product(p, d, q))
for param in pdq:
    mod = ARIMA(train, order=param)
    results = mod.fit()

    print('ARIMA{} AIC:{}'.format(param, results.aic))

ARIMA(0, 0, 0) AIC:17153.28608377512
ARIMA(0, 0, 1) AIC:14407.085213632363
ARIMA(0, 1, 0) AIC:3812.4806641861296
ARIMA(0, 1, 1) AIC:3812.306176824848
ARIMA(1, 0, 0) AIC:3823.4611095477635
ARIMA(1, 0, 1) AIC:3823.432441560404
ARIMA(1, 1, 0) AIC:3812.267920836725
ARIMA(1, 1, 1) AIC:3808.9980010413774

Listing 2-12ARIMA Hyperparameters Optimization

```

## å‘å±• ARIMA æ¨¡å¼

åˆ—è¡¨ [2-13](#PC13) å®Œæˆäº† ARIMA (1ï¼Œ1ï¼Œ1)æ¨¡å‹ï¼Œå¹¶æ„å»ºäº†æ¨¡å‹æ€§èƒ½è¯„ä¼°çš„ profile è¡¨(è§è¡¨ [2-3](#Tab3) )ã€‚æˆ‘ä»¬åªé€‰æ‹© ARIMA (1ï¼Œ1ï¼Œ1)ï¼Œå› ä¸ºå®ƒçš„ AIC åˆ†æ•°æœ€ä½ã€‚AIC æ˜¯ç¡®å®šæ‹Ÿåˆä¼˜åº¦å’Œæ¨¡å‹ç®€å•æ€§çš„ç»Ÿè®¡æµ‹è¯•ã€‚ç®€å•åœ°è¯´ï¼Œå®ƒè¡¨ç¤ºæ¨¡å‹ä¸¢å¤±ä¿¡æ¯çš„ç¨‹åº¦ã€‚å› æ­¤ï¼Œorder = (1ï¼Œ1ï¼Œ1)åœ¨é»˜è®¤æƒ…å†µä¸‹æ¯”åˆ—è¡¨ [2-12](#PC12) ä¸­èŒƒå›´å†…çš„å…¶ä»–è®¢å•å…·æœ‰æ›´å¼ºçš„é¢„æµ‹èƒ½åŠ›ã€‚

è¡¨ 2-3

ARIMA æ¨¡å‹ç»“æœ

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"> <col class="tcol4 align-left"></colgroup> 
| 

ç¦»å¼€å˜é‡:

 | 

D.æ¥è¿‘çš„

 | 

æ•°é‡æ„è§:

 | 

Two thousand and eighty-four

 |
| --- | --- | --- | --- |
| **å‹å·:** | ARIMA(1ï¼Œ1ï¼Œ1) | **å¯¹æ•°å¯èƒ½æ€§** | -1900.499 |
| **æ–¹æ³•:** | css-mle | **åˆ›æ–°çš„ s . d .** | Zero point six zero two |
| **æ—¥æœŸ:** | æ”¶é›†ï¼Œ01 apr 2021 | AIC | Three thousand eight hundred and eight point nine nine eight |
| **æ—¶é—´:** | 02:54:35 | BIC | Three thousand eight hundred and thirty-one point five six six |
| **æ ·æœ¬:** | one | **HQIC** | Three thousand eight hundred and seventeen point two six seven |

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"> <col class="tcol4 align-left"> <col class="tcol5 align-left"> <col class="tcol6 align-left"> <col class="tcol7 align-left"></colgroup> 
| Â  | 

**coef**

 | 

**æ ‡å‡†è¯¯å·®**

 | 

**Z**

 | 

**P > &#124;z&#124;**

 | 

**ã€0.025**

 | 

**0.975ã€‘**

 |
| --- | --- | --- | --- | --- | --- | --- |
| **å¸¸æ•°** | 0.0156 | Zero point zero one three | One point one nine nine | Zero point two three one | -0.010 | Zero point zero four one |
| **ç©ºæ°”ã€‚L1.D.Adj Close** | -0.8638 | Zero point zero nine four | -9.188 | Zero | -1.048 | -0.680 |
| **é©¬ã€‚L1.D.Adj å…³é—­** | 0.8336 | Zero point one zero three | Eight point zero nine five | Zero | Zero point six three two | One point zero three five |

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"> <col class="tcol4 align-left"> <col class="tcol5 align-left"></colgroup> 
| Â  | 

**çœŸå®**

 | 

**å‡æƒ³çš„**

 | 

**æ¨¡æ•°**

 | 

**é¢‘ç‡**

 |
| --- | --- | --- | --- | --- |
| **AR.1** | -1.1576 | +0.0000 ç„¦è€³ | 1.1576 | 0.5000 |
| **MA.1** | -1.1996 | +0.0000 ç„¦è€³ | 1.1996 | 0.5000 |

```py
arima_model = ARIMA(train, order=(1, 1, 1))
arima_fitted = arima_model.fit()
arima_fitted.summary()

Listing 2-13Finalize the ARIMA Model

```

### ä½¿ç”¨ ARIMA æ¨¡å‹è¿›è¡Œé¢„æµ‹

å®Œæˆ ARIMA (1ï¼Œ1ï¼Œ1)æ¨¡å‹åï¼Œä¸‹ä¸€æ­¥é€šå¸¸éœ€è¦è¯†åˆ«è°ƒæ•´åæ”¶ç›˜ä»·çš„æ½œåœ¨æ¨¡å¼å¹¶é¢„æµ‹æœªæ¥ä»·æ ¼(è§å›¾ [2-8](#Fig8) )ã€‚è§æ¸…å• [2-14](#PC14) ã€‚

![img/509469_1_En_2_Fig8_HTML.jpg](img/509469_1_En_2_Fig8_HTML.jpg)

å›¾ 2-8

ARIMA (1ï¼Œ1ï¼Œ1)é¢„æµ‹

```py
fc, se, conf = arima_fitted.forecast(501, alpha=0.05)
fc_series = pd.Series(fc, index=test.index)
lower_series = pd.Series(conf[:, 0], index=test.index)
upper_series = pd.Series(conf[:, 1], index=test.index)
plt.plot(train, label="Training",color="navy")
plt.plot(test, label="Actual",color="orange")
plt.plot(fc_series, label="Forecast",color="red")
plt.fill_between(lower_series.index,
                 lower_series,
                 upper_series,
                 color='gray')
plt.legend(loc='upper left')
plt.xticks(rotation=45)
plt.xlabel("Date")

plt.ylabel("Adj Close")
plt.show()

Listing 2-14Forecast ARIMA Model

```

å›¾ [2-8](#Fig8) æ˜¾ç¤ºæ¨¡å‹åœ¨é¢„æµ‹æ—¶å‡ºç°è¯¯å·®ã€‚ç°è‰²åŒºåŸŸ(å¡«å……åŒºé—´)ä»£è¡¨ç½®ä¿¡åŒºé—´ã€‚

## è¨é‡Œç›æ¨¡å‹

è™½ç„¶ ARIMA æ¨¡å‹æ˜¯åˆ†æå•å˜é‡æ—¶é—´åºåˆ—æ•°æ®æ¨¡å¼çš„å¼ºå¤§æ¨¡å‹ï¼Œä½†å®ƒåœ¨å¤„ç†å­£èŠ‚æ€§æ•°æ®æ—¶ä¼šå‡ºé”™ã€‚å‘æ¨¡å‹ä¸­æ·»åŠ å­£èŠ‚æ€§è®¢å•å¯ä»¥å¢å¼ºå…¶æ€§èƒ½ã€‚è¨é‡Œç›æ‰©å±•äº† ARIMA æ¨¡å‹ã€‚åœ¨å¯¹æ—¶é—´åºåˆ—æ•°æ®å»ºæ¨¡æ—¶ï¼Œå®ƒè€ƒè™‘äº†å­£èŠ‚æ€§å› ç´ ã€‚

### SARIMA è¶…å‚æ•°ä¼˜åŒ–

æ¸…å• [2-15](#PC15) ä½¿ç”¨`itertools`åŒ…æ‰¾åˆ°ä½¿ç”¨ AIC çš„æœ€ä½³è¶…å‚æ•°(å‚è€ƒæ¸…å• [2-12](#PC12) )ã€‚SciPy åŒ…é¢„å®‰è£…åœ¨ Python ç¯å¢ƒä¸­ã€‚

```py
import scipy.stats as stats
p = d = q = range(0,2)
pdq = list(itertools.product(p,d,q))
seasonal_pdq = [(x[0],x[1],x[2],12) for x in list(itertools.product(p,d,q))]
for param in pdq:
    for param_seasonal in seasonal_pdq:
        try:
            model = sm.tsa.statespace.SARIMAX(train,
                             order=param,
                             seasonal_order=param_seasonal,
                             enforce_stationarity=False,
                             enforce_intervibility=False)
            results = model.fit()
            print("SARIMAX {} x {} 12 - AIC: {}".format(param,param_seasonal,results.aic))
        except:
            continue
SARIMAX (1, 1, 1) x (0, 1, 1, 12) 12 - AIC: 3822.8419684760634
SARIMAX (1, 1, 1) x (1, 0, 0, 12) 12 - AIC: 3795.147211266854
SARIMAX (1, 1, 1) x (1, 0, 1, 12) 12 - AIC: 3795.0731989219726
SARIMAX (1, 1, 1) x (1, 1, 0, 12) 12 - AIC: 4580.905706671067
SARIMAX (1, 1, 1) x (1, 1, 1, 12) 12 - AIC: 3824.843959188799

Listing 2-15SARIMA Hyperparameter Optimization

```

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åªæ˜¾ç¤ºäº†æœ€åäº”ä¸ªè¾“å‡ºã€‚å‰é¢çš„ä»£ç ä» SARIMAX (0ï¼Œ0ï¼Œ0) Ã— (0ï¼Œ0ï¼Œ0ï¼Œ12) 12 åˆ° SARIMAX (1ï¼Œ1ï¼Œ1) Ã— (1ï¼Œ1ï¼Œ12) 12 ä¼°ç®— AICã€‚æˆ‘ä»¬å‘ç° SARIMAX (1ï¼Œ1ï¼Œ1) Ã— (1ï¼Œ1ï¼Œ1ï¼Œ12) 12 å…·æœ‰æœ€ä½çš„ AIC åˆ†æ•°ã€‚æ¸…å• [2-16](#PC16) ç”¨ order = (1ï¼Œ1ï¼Œ1)å®Œæˆäº† SARIMA æ¨¡å‹ã€‚

### å¼€å‘ä¸€ä¸ªè¨é‡Œç›æ¨¡å‹

æ¸…å• [2-16](#PC16) å®Œæˆäº† SARIMA æ¨¡å‹ï¼Œä½†æ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œé™æ€å’Œå¯é€†ï¼Œå¹¶æ„å»ºäº†ä¸€ä¸ªåŒ…å«æ¨¡å‹æ€§èƒ½ä¿¡æ¯çš„è¡¨æ ¼(è§è¡¨ [2-4](#Tab4) )ã€‚

è¡¨ 2-4

è¨é‡Œç›è½®å»“

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"> <col class="tcol4 align-left"></colgroup> 
| 

ç¦»å¼€å˜é‡:

 | 

Y

 | 

æ•°é‡æ„è§:

 | 

Two thousand and eighty-five

 |
| --- | --- | --- | --- |
| **å‹å·:** | SARIMAX(1ï¼Œ1ï¼Œ1) | **å¯¹æ•°å¯èƒ½æ€§** | -1901.217 |
| **æ—¥æœŸ:** | 2020 å¹´ 11 æœˆ 14 æ—¥æ˜ŸæœŸå…­ | AIC | Three thousand eight hundred and eight point four three five |
| **æ—¶é—´:** | 02:01:47 | BIC | Three thousand eight hundred and twenty-five point three six one |
| **æ ·æœ¬:** | Zero | **HQIC** | Three thousand eight hundred and fourteen point six three seven |
| Â  | - 2085 | Â  | Â  |
| **åæ–¹å·®ç±»å‹:** | æ°§åŸºèšæ˜èƒ¶ | Â  | Â  |

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"> <col class="tcol4 align-left"> <col class="tcol5 align-left"> <col class="tcol6 align-left"> <col class="tcol7 align-left"></colgroup> 
| Â  | 

**coef**

 | 

**æ ‡å‡†è¯¯å·®**

 | 

**z**

 | 

**P > &#124;z&#124;**

 | 

**ã€0.025**

 | 

**0.975ã€‘**

 |
| --- | --- | --- | --- | --- | --- | --- |
| **ç©ºæ°”ã€‚L1ã€”t1ã€•** | -0.8645 | Zero point zero eight three | -10.411 | Zero | -1.027 | -0.702 |
| **é©¬ã€‚L1** | 0.8344 | Zero point zero nine | Nine point two five eight | Zero | Zero point six five eight | One point zero one one |
| **ã€sigma 2ã€‘** | 0.3630 | Zero point zero zero seven | Fifty-two point three three nine | Zero | Zero point three four nine | Zero point three seven seven |

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"> <col class="tcol4 align-left"></colgroup> 
| 

**é’ç›’å­(Q):**

 | 

Fifty-eight point seven seven

 | 

**èŠ±å›­-è´æ‹‰(JB):**

 | 

Nine hundred and fifty-five point one six

 |
| --- | --- | --- | --- |
| **Prob(Q):** | Zero point zero three | **Prob(JB):** | Zero |
| **å¼‚æ–¹å·®(H):** | One point three five | **åæ–œ:** | Zero point zero four |
| **Prob(H)(åŒé¢):** | Zero | **å³°åº¦:** | Six point three two |

```py
import pmdarima as pm
sarimax_model = pm.auto_arima(train, start_p=1, start_q=1, start_P=1, start_Q=1,
                     max_p=5, max_q=5, max_P=5, max_Q=5, seasonal=True,
                     stepwise=True, suppress_warnings=True, D=10, max_D=10,
                     error_action='ignore')
sarimax_model.summary()

Listing 2-16Finalize the SARIMA Model

```

è¡¨ [2-4](#Tab4) æ˜¾ç¤º ar çš„ p å€¼ã€‚é©¬è¨è¯¸å¡å· L1ã€‚L1 å’Œå¤§äº 0.05 çš„è¥¿æ ¼ç›ã€‚æˆ‘ä»¬å¯ä»¥ç¡®è®¤è¿™ä¸ªæ•°åˆ—æ˜¯å¹³ç¨³çš„ã€‚

### ä½¿ç”¨ ARIMA æ¨¡å‹è¿›è¡Œé¢„æµ‹

æ¸…å• [2-17](#PC17) æ„å»ºäº†ä¸€ä¸ªå›¾è¡¨ï¼Œæ˜¾ç¤ºäº†ä¹‹å‰è°ƒæ•´çš„ç¾å…ƒ/æ—¥å…ƒå¯¹çš„æ”¶ç›˜ä»·ä»¥åŠç”± SARIMA (1ï¼Œ1ï¼Œ12)æ¨¡å‹é¢„æµ‹çš„æ”¶ç›˜ä»·(è§å›¾ [2-9](#Fig9) )ã€‚

![img/509469_1_En_2_Fig9_HTML.jpg](img/509469_1_En_2_Fig9_HTML.jpg)

å›¾ 2-9

SARIMA (1ï¼Œ1ï¼Œ1ï¼Œ12)é¢„æµ‹

```py
n_periods = 24
fitted, confint = sarimax_model.predict(n_periods=n_periods, return_conf_int=True)
index_of_fc = pd.date_range(train.index[-1], periods = n_periods, freq='MS')
fitted_series = pd.Series(fitted, index=index_of_fc)
lower_series = pd.Series(confint[:, 0], index=index_of_fc)
upper_series = pd.Series(confint[:, 1], index=index_of_fc)
plt.plot(train, label="Training",color="navy")
plt.plot(test, label="Actual",color="orange")
plt.plot(fitted_series, label="Forecast",color="red")
plt.fill_between(lower_series.index,
                 lower_series,
                 upper_series,
                 color='gray')
plt.legend(loc='upper left')
plt.xticks(rotation=45)
plt.xlabel("Date")
plt.ylabel("Adj Close")

plt.show()

Listing 2-17SARIMA Model Forecast

```

å›¾ [2-9](#Fig9) æ˜¾ç¤ºäº†ä¸€ä¸ªçª„èŒƒå›´çš„é¢„æµ‹ã€‚ä¸¤ä¸ªæ¨¡å‹éƒ½ä¸èƒ½æœ€å¥½åœ°è§£é‡Šæ—¶é—´åºåˆ—æ•°æ®ï¼›ä»–ä»¬åœ¨é¢„æµ‹æœªæ¥ä»·æ ¼æ—¶ä¼šçŠ¯å¾®å°çš„é”™è¯¯ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä½¿ç”¨ Prophet åŒ…ä¸­çš„é™„åŠ æ¨¡å‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

## åŠ æ³•æ¨¡å‹

é™¤äº†è¶‹åŠ¿å’Œå­£èŠ‚æ€§ï¼Œè¿˜æœ‰å…¶ä»–å› ç´ å½±å“ä»·æ ¼å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œåœ¨å…¬å…±å‡æ—¥æœŸé—´ï¼Œäº¤æ˜“æ´»åŠ¨ä¸åŒäºæ­£å¸¸äº¤æ˜“æ—¥ã€‚ARIMA å’Œè¨é‡Œç›æ¨¡å‹éƒ½æ²¡æœ‰è€ƒè™‘å…¬å…±å‡æœŸçš„å½±å“ã€‚åŠ æ³•æ¨¡å‹è§£å†³äº†è¿™ä¸€æŒ‘æˆ˜ã€‚å®ƒè€ƒè™‘äº†æ¯æ—¥ã€æ¯å‘¨å’Œæ¯å¹´çš„å­£èŠ‚æ€§å’Œéçº¿æ€§è¶‹åŠ¿ã€‚å®ƒå‡è®¾è¶‹åŠ¿å’Œå‘¨æœŸæ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œå¹¶æ— ç¼æ·»åŠ äº†å®˜æ–¹å…¬å…±å‡æœŸå’Œè¯¯å·®çš„å½±å“ã€‚è¯¥å…¬å¼åœ¨æ•°å­¦ä¸Šå†™æˆç­‰å¼ [2-1](#Equ1) ã€‚

![$$ y=g(t)+s(t)+h(t)+{\varepsilon}_i $$](img/509469_1_En_2_Chapter_TeX_Equ1.png)

(æ–¹ç¨‹å¼ 2-1)

è¿™é‡Œï¼Œ *g* ( *t* )è¡¨ç¤ºç”¨äºå»ºæ¨¡éå‘¨æœŸæ€§å˜åŒ–çš„çº¿æ€§æˆ–é€»è¾‘å¢é•¿æ›²çº¿ï¼Œ *s* ( *t* )è¡¨ç¤ºå‘¨æœŸæ€§å˜åŒ–(æ¯æ—¥ã€æ¯å‘¨ã€æ¯å¹´çš„å­£èŠ‚æ€§)ï¼Œ *h* ( *t* )è¡¨ç¤ºèŠ‚å‡æ—¥çš„å½±å“ï¼Œ+ ğœ€ğ‘–è¡¨ç¤ºè€ƒè™‘å¼‚å¸¸å˜åŒ–çš„è¯¯å·®é¡¹ã€‚

æ¸…å• [2-18](#PC18) é‡æ–°åˆ©ç”¨æ•°æ®(è§è¡¨ [2-5](#Tab5) )ã€‚è¯·æ³¨æ„ï¼Œåœ¨æ¸…å• [2-2](#PC2) ä¸­ï¼Œæˆ‘ä»¬åˆ é™¤äº†ä½ä»·æ ¼ã€é«˜ä»·æ ¼ã€å¼€ç›˜ä»·å’Œæ”¶ç›˜ä»·ã€‚æˆ‘ä»¬å¯¹é¢„æµ‹è°ƒæ•´åçš„æ”¶ç›˜ä»·æ„Ÿå…´è¶£ã€‚

è¡¨ 2-5

èµ„æ–™ç»„

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"> <col class="tcol4 align-left"></colgroup> 
| 

**æ—¥æœŸ**

 | 

æ¥è¿‘çš„

 | 

ä»è®°å·å¤„å¼€å§‹é‡å¤ä¸€é

 | 

y

 |
| --- | --- | --- | --- |
| **2010-11-01** | 80.405998 | 2010-11-01 | 80.405998 |
| **2010-11-02** | 80.558998 | 2010-11-02 | 80.558998 |
| **2010-11-03** | 80.667999 | 2010-11-03 | 80.667999 |
| **2010-11-04** | 81.050003 | 2010-11-04 | 81.050003 |
| **2010-11-05** | 80.776001 | 2010-11-05 | 80.776001 |
| **...** | ... | ... | ... |
| **2020-10-27** | 104.832001 | 2020-10-27 | 104.832001 |
| **2020-10-28** | 104.544998 | 2020-10-28 | 104.544998 |
| **2020-10-29** | 104.315002 | 2020-10-29 | 104.315002 |
| **2020-10-30** | 104.554001 | 2020-10-30 | 104.554001 |
| **2020-11-02** | 104.580002 | 2020-11-02 | 104.580002 |

```py
df = df.reset_index()
df["ds"] = df["Date"]
df["y"] = df["Adj Close"]
df.set_index("Date")

Listing 2-18Data Preprocessing

```

æ¸…å• [2-19](#PC19) æŒ‡å®šäº†å…¶æ•ˆæœå°†è¢«æ·»åŠ åˆ°æ¨¡å‹ä¸­çš„å®˜æ–¹å…¬å…±å‡æ—¥(å‚è§æ¸…å• [2-20](#PC20) )ã€‚

```py
holidays = pd.DataFrame({
  'holiday': 'playoff',
  'ds': pd.to_datetime(["2020-12-25", "2020-12-24", "2020-12-23", "2019-12-25", "2021-01-01", "2021-01-20"]),
    "lower_window": 0,
    "upper_window": 1,
})

Listing 2-19Specify Holidays

```

æ¸…å• [2-20](#PC20) å®Œæˆäº†ç½®ä¿¡åŒºé—´ä¸º 95%çš„åŠ æ³•æ¨¡å‹ï¼›å®ƒè€ƒè™‘äº†æ¯å¹´çš„å­£èŠ‚æ€§ã€æ¯å‘¨çš„å­£èŠ‚æ€§ã€æ¯å¤©çš„å­£èŠ‚æ€§å’Œå®˜æ–¹çš„å…¬å…±å‡æ—¥ã€‚

```py
from fbprophet import Prophet

m = Prophet(holidays=holidays,
            interval_width=0.95,
            yearly_seasonality=True,
            weekly_seasonality=True,
            daily_seasonality=True,
            changepoint_prior_scale=0.095)
m.add_country_holidays(country_name='US')
m.fit(df)

Listing 2-20Develop Prophet Model

```

### é¢„æŠ¥

æ¸…å• [2-21](#PC21) é¢„æµ‹æœªæ¥è°ƒæ•´åçš„æ”¶ç›˜ä»·ï¼Œå¹¶æ˜¾ç¤ºæ—¶é—´åºåˆ—æ•°æ®å’ŒåŠ æ€§æ¨¡å‹é¢„æµ‹çš„ä»·æ ¼ä¸­çš„æ¨¡å¼(è§å›¾ [2-10](#Fig10) )ã€‚

![img/509469_1_En_2_Fig10_HTML.jpg](img/509469_1_En_2_Fig10_HTML.jpg)

å›¾ 2-10

é¢„æŠ¥

```py
future = m.make_future_dataframe(periods=365)
forecast = m.predict(future)
m.plot(forecast)
plt.xlabel("Date")
plt.ylabel("Adj Close")
plt.xticks(rotation=45)
plt.show()

Listing 2-21Forecast

```

å›¾ [2-10](#Fig10) ä¸ ARIMA æ¨¡å‹å’Œè¨é‡Œç›æ¨¡å‹éƒ½ä¸ä¸€è‡´(ä¸¤ä¸ªæ¨¡å‹éƒ½é¢„æµ‹æœ‰ä¸Šå‡è¶‹åŠ¿)ã€‚ç„¶è€Œï¼ŒåŠ æ€§æ¨¡å‹å®é™…ä¸Šä¸æ•°æ®ç›¸ç¬¦ã€‚

### å­£èŠ‚æ€§åˆ†è§£

æ¸…å• [2-22](#PC22) åº”ç”¨`plot_decompose()`æ–¹æ³•å°†åºåˆ—åˆ†è§£ä¸ºå­£èŠ‚æ€§ã€è¶‹åŠ¿å’Œä¸è§„åˆ™æˆåˆ†(è§å›¾ [2-11](#Fig11) )ã€‚åˆ†è§£åŒ…æ‹¬å°†æ—¶é—´åºåˆ—åˆ†è§£æˆå¤šä¸ªéƒ¨åˆ†ï¼Œä»¥äº†è§£åºåˆ—ä¸­çš„é‡å¤æ¨¡å¼ã€‚å®ƒå¸®åŠ©ç¡®å®šå•å˜é‡æ—¶é—´åºåˆ—åˆ†æçš„å‚æ•°ï¼›æˆ‘ä»¬å¯ä»¥ç¡®å®šåºåˆ—ä¸­æ˜¯å¦å­˜åœ¨è¶‹åŠ¿å’Œå­£èŠ‚æ€§ã€‚

![img/509469_1_En_2_Fig11_HTML.jpg](img/509469_1_En_2_Fig11_HTML.jpg)

å›¾ 2-11

å­£èŠ‚æ€§æˆåˆ†

```py
m.plot_components(forecast)
plt.show()

Listing 2-22Seasonal Components

```

å›¾ [2-11](#Fig11) æ˜¾ç¤ºäº†æ¸…æ™°çš„æ¯æ—¥ã€æ¯å‘¨å’Œæ¯å¹´çš„å­£èŠ‚æ€§ã€‚åœ¨ä¸€å¹´çš„å‰å‡ ä¸ªæœˆï¼Œè°ƒæ•´åçš„æ”¶ç›˜ä»·ä¸‹é™ï¼Œå¹¶åœ¨ä¸€å¹´çš„æœ€åä¸¤ä¸ªå­£åº¦è¾¾åˆ°å³°å€¼ã€‚

## ç»“è®º

æœ¬ç« è¯¦ç»†ä»‹ç»äº†æ—¶é—´åºåˆ—åˆ†ææ–¹æ³•ã€‚æˆ‘ä»¬å¼€å‘å¹¶å…¬æ­£åœ°æ¯”è¾ƒäº† ARIMA å’Œè¨é‡Œç›æ¨¡å‹çš„æ€§èƒ½ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æŸ¥çœ‹äº† Prophet åŒ…è£…ä¸­çš„æ·»åŠ å‰‚å‹å·ã€‚åœ¨ä»”ç»†æ£€æŸ¥äº†æ‰€æœ‰ä¸‰ä¸ªæ¨¡å‹çš„è¡¨ç°åï¼Œæˆ‘ä»¬æ³¨æ„åˆ°åŠ æ³•æ¨¡å‹çŠ¯äº†ä¸€äº›å°é”™è¯¯ï¼Œå¹¶ä¸”å¯¹ç¾å…ƒ/æ—¥å…ƒå¯¹çš„æœªæ¥ä»·æ ¼æœ‰æ›´å¼ºçš„é¢„æµ‹ã€‚ä¸ºäº†æé«˜æ¨¡å‹çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€æœ¯ï¼Œå¦‚æ”¹å˜æ•°æ®åˆ†å‰²ç‡ã€å‰”é™¤å¼‚å¸¸å€¼ã€æ•°æ®è½¬æ¢ä»¥åŠçº³å…¥èŠ‚å‡æ—¥çš„å½±å“ã€‚